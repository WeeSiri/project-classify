<?php
    session_start();
    include('server.php');
    $errors = array();

    // ตรวจสอบว่าได้รับ suggest_id จากการส่งผ่าน GET หรือไม่
    $suggest = null; // กำหนดให้เป็น null เริ่มต้น
    $rule_description = ""; // กำหนดให้เป็นข้อความว่างเริ่มต้น

    // ตรวจสอบว่าได้รับ suggest_id จากการส่งผ่าน GET หรือไม่
    if (isset($_GET['suggest_id'])) {
        $suggest_id = $_GET['suggest_id'];
        
        // ดึงข้อมูลคำแนะนำที่ต้องการแก้ไขจากฐานข้อมูล
        $sql = "SELECT * FROM suggest WHERE suggest_id = ?";
        $stmt = mysqli_prepare($conn, $sql);
        mysqli_stmt_bind_param($stmt, "i", $suggest_id);
        mysqli_stmt_execute($stmt);
        $result = mysqli_stmt_get_result($stmt);
        $suggest = mysqli_fetch_assoc($result);

        // ตรวจสอบว่าพบคำแนะนำที่ต้องการแก้ไขหรือไม่
        if (!$suggest) {
            echo "ไม่พบคำแนะนำที่ต้องการแก้ไข";
            exit;
        }

        // กำหนดหมายเลขกฎที่ต้องการแสดง
        $rule_number = $suggest['rule_number'];

        // ดึงรายละเอียดของกฎที่เกี่ยวข้องจากข้อความที่เก็บไว้
        $messages = [
            "1" => "กฎข้อที่ 1 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 1, 1.5 หรือ 2 และ วิชาสังคมศึกษาได้เกรด 2.5 หรือ 3 แล้ว จัดอยู่ในกลุ่มเก่ง",
            "2" => "กฎข้อที่ 2 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 1, 1.5 หรือ 2 และ วิชาสังคมศึกษาได้เกรด 1, 1.5 หรือ 2 แล้ว จัดอยู่ในกลุ่มอ่อน",
            "3" => "กฎข้อที่ 3 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ พลศึกษาได้เกรด 1, 1.5 หรือ 2 และ สังคมศึกษาได้เกรด 3.5 หรือ 4 แล้ว จัดอยู่ในกลุ่มอ่อน",
            "4" => "กฎข้อที่ 4 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 3.5 หรือ 4 และ วิชาประวัติศาสตร์ได้เกรด 1, 1.5 หรือ 2 แล้ว จัดอยู่ในกลุ่มปานกลาง",
            "5" => "กฎข้อที่ 5 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 3.5 หรือ 4 และ วิชาประวัติศาสตร์ได้เกรด 2.5 หรือ 3 และ วิชาการงานอาชีพได้เกรด 2.5 หรือ 3 แล้ว จัดอยู่ในกลุ่มปานกลาง",
            "6" => "กฎข้อที่ 6 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 3.5 หรือ 4 และ วิชาประวัติศาสตร์ได้เกรด 2.5 หรือ 3 และ วิชาการงานอาชีพได้เกรด 3.5 หรือ 4 และ วิชาภาษาอังกฤษเพิ่มเติมได้เกรด 3.5 หรือ 4 แล้ว จัดอยู่ในกลุ่มอ่อน",
            "7" => "กฎข้อที่ 7 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 3.5 หรือ 4 และ วิชาประวัติศาสตร์ได้เกรด 2.5 หรือ 3 และ วิชาการงานอาชีพได้เกรด 3.5 หรือ 4 และ วิชาภาษาอังกฤษเพิ่มเติมได้เกรด 2.5 หรือ 3 แล้ว จัดอยู่ในกลุ่มปานกลาง",
            "8" => "กฎข้อที่ 8 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 3.5 หรือ 4 และ วิชาประวัติศาสตร์ได้เกรด 2.5 หรือ 3 และ วิชาการงานอาชีพได้เกรด 3.5 หรือ 4 และ วิชาภาษาอังกฤษเพิ่มเติมได้เกรด 1, 1.5 หรือ 2 แล้ว จัดอยู่ในกลุ่มปานกลาง",
            "9" => "กฎข้อที่ 9 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 3.5 หรือ 4 และ วิชาประวัติศาสตร์ได้เกรด 2.5 หรือ 3 และ วิชาการงานอาชีพได้เกรด 1, 1.5 หรือ 2 แล้ว จัดอยู่ในกลุ่มปานกลาง",
            "10" => "กฎข้อที่ 10 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 3.5 หรือ 4 และ วิชาประวัติศาสตร์ได้เกรด 3.5 หรือ 4 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 2.5 หรือ 3 แล้ว จัดอยู่ในกลุ่มปานกลาง",
            "11" => "กฎข้อที่ 11 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 3.5 หรือ 4 และ วิชาประวัติศาสตร์ได้เกรด 3.5 หรือ 4 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 3.5 หรือ 4 แล้ว จัดอยู่ในกลุ่มเก่ง",
            "12" => "กฎข้อที่ 12 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 3.5 หรือ 4 และ วิชาประวัติศาสตร์ได้เกรด 3.5 หรือ 4 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 1, 1.5 หรือ 2 แล้ว จัดอยู่ในกลุ่มเก่ง",
            "13" => "กฎข้อที่ 13 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 2.5 หรือ 3 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 2.5 หรือ 3 และ วิชาคอมพิวเตอร์เพิ่มเติมได้เกรด 1, 1.5 หรือ 2 แล้ว จัดอยู่ในกลุ่มเก่ง",
            "14" => "กฎข้อที่ 14 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 2.5 หรือ 3 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 2.5 หรือ 3 และ วิชาคอมพิวเตอร์เพิ่มเติมได้เกรด 2.5 หรือ 3 แล้ว จัดอยู่ในกลุ่มอ่อน",
            "15" => "กฎข้อที่ 15 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 2.5 หรือ 3 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 2.5 หรือ 3 และ วิชาคอมพิวเตอร์เพิ่มเติมได้เกรด 3.5 หรือ 4 แล้ว จัดอยู่ในกลุ่มเก่ง",
            "16" => "กฎข้อที่ 16 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 2.5 หรือ 3 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 3.5 หรือ 4 และ วิชาวิทยาศาสตร์ได้เกรด 1, 1.5 หรือ 2 แล้ว จัดอยู่ในกลุ่มอ่อน",
            "17" => "กฎข้อที่ 17 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 2.5 หรือ 3 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 3.5 หรือ 4 และ วิชาวิทยาศาสตร์ได้เกรด 2.5 หรือ 3 แล้ว จัดอยู่ในกลุ่มปานกลาง",
            "18" => "กฎข้อที่ 18 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 2.5 หรือ 3 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 3.5 หรือ 4 และ วิชาวิทยาศาสตร์ได้เกรด 3.5 หรือ 4 แล้ว จัดอยู่ในกลุ่มอ่อน",
            "19" => "กฎข้อที่ 19 ถ้า วิชาภาษาอังกฤษได้เกรด 2.5 หรือ 3 และ วิชาพลศึกษาได้เกรด 2.5 หรือ 3 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 1, 1.5 หรือ 2 แล้ว จัดอยู่ในกลุ่มอ่อน",
            "20" => "กฎข้อที่ 20 ถ้า วิชาภาษาอังกฤษได้เกรด 3.5 หรือ 4 และ วิชาภาษาไทยได้เกรด 2.5 หรือ 3 แล้ว จัดอยู่ในกลุ่มเก่ง",
            "21" => "กฎข้อที่ 21 ถ้า วิชาภาษาอังกฤษได้เกรด 3.5 หรือ 4 และ วิชาภาษาไทยได้เกรด 3.5 หรือ 4 และ วิชาคณิตศาสตร์ได้เกรด 1, 1.5 หรือ 2 แล้ว จัดอยู่ในกลุ่มอ่อน",
            "22" => "กฎข้อที่ 22 ถ้า วิชาภาษาอังกฤษได้เกรด 3.5 หรือ 4 และ วิชาภาษาไทยได้เกรด 3.5 หรือ 4 และ วิชาคณิตศาสตร์ได้เกรด 2.5 หรือ 3 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 2.5 หรือ 3 แล้ว จัดอยู่ในกลุ่มเก่ง",
            "23" => "กฎข้อที่ 23 ถ้า วิชาภาษาอังกฤษได้เกรด 3.5 หรือ 4 และ วิชาภาษาไทยได้เกรด 3.5 หรือ 4 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 3.5 หรือ 4 และ วิชาคอมพิวเตอร์เพิ่มเติมได้เกรด 1, 1.5 หรือ 2 แล้ว จัดอยู่ในกลุ่มเก่ง",
            "24" => "กฎข้อที่ 24 ถ้า วิชาภาษาอังกฤษได้เกรด 3.5 หรือ 4 และ วิชาภาษาไทยได้เกรด 3.5 หรือ 4 และ วิชาคณิตศาสตร์ได้เกรด 2.5 หรือ 3 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 3.5 หรือ 4 และ วิชาคอมพิวเตอร์เพิ่มเติมได้แกรด 2.5 หรือ 3 แล้ว จัดอยู่ในกลุ่มเก่ง",
            "25" => "กฎข้อที่ 25 ถ้า วิชาภาษาอังกฤษได้เกรด 3.5 หรือ 4 และ วิชาภาษาไทยได้เกรด 3.5 หรือ 4 และ วิชาคณิตศาสตร์ได้เกรด 2.5 หรือ 3 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 3.5 หรือ 4 และ วิชาคอมพิวเตอร์เพิ่มเติมได้เกรด 3.5 หรือ 4 แล้ว จัดอยู่ในกลุ่มปานกลาง",
            "26" => "กฎข้อที่ 26 ถ้า วิชาภาษาอังกฤษได้เกรด 3.5 หรือ 4 และ วิชาภาษาไทยได้เกรด 3.5 หรือ 4 และ วิชาคณิตศาสตร์ได้เกรด 2.5 หรือ 3 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 1, 1.5 หรือ 2 แล้ว จัดอยู่ในกลุ่มเก่ง",
            "27" => "กฎข้อที่ 27 ถ้า วิชาภาษาอังกฤษได้เกรด 3.5 หรือ 4 และ วิชาภาษาไทยได้เกรด 3.5 หรือ 4 และ วิชาคณิตศาสตร์ได้เกรด 3.5 หรือ 4 และ วิชาคอมพิวเตอร์เพิ่มเติมได้เกรด 1, 1.5 หรือ 2 แล้ว จัดอยู่ในกลุ่มปานกลาง",
            "28" => "กฎข้อที่ 28 ถ้า วิชาภาษาอังกฤษได้เกรด 3.5 หรือ 4 และ วิชาภาษาไทยได้เกรด 3.5 หรือ 4 และ วิชาคณิตศาสตร์ได้เกรด 3.5 หรือ 4 และ วิชาคอมพิวเตอร์เพิ่มเติมได้เกรด 2.5 หรือ 3 แล้ว จัดอยู่ในกลุ่มเก่ง",
            "29" => "กฎข้อที่ 29 ถ้า วิชาภาษาอังกฤษได้เกรด 3.5 หรือ 4 และ วิชาภาษาไทยได้เกรด 3.5 หรือ 4 และ วิชาคณิตศาสตร์ได้เกรด 3.5 หรือ 4 และ วิชาคอมพิวเตอร์เพิ่มเติมได้เกรด 3.5 หรือ 4 แล้ว จัดอยู่ในกลุ่มเก่ง",
            "30" => "กฎข้อที่ 30 ถ้า วิชาภาษาอังกฤษได้เกรด 3.5 หรือ 4 และ วิชาภาษาไทยได้เกรด 1, 1.5 หรือ 2 แล้ว จัดอยู่ในกลุ่มเก่ง",
            "31" => "กฎข้อที่ 31 ถ้า วิชาภาษาอังกฤษได้เกรด 1, 1.5 หรือ 2 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 2.5 หรือ 3 แล้ว จัดอยู่ในกลุ่มอ่อน",
            "32" => "กฎข้อที่ 32 ถ้า วิชาภาษาอังกฤษได้เกรด 1, 1.5 หรือ 2 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 3.5 หรือ 4 แล้ว จัดอยู่ในกลุ่มเก่ง",
            "33" => "กฎข้อที่ 33 ถ้า วิชาภาษาอังกฤษได้เกรด 1, 1.5 หรือ 2 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 1, 1.5 หรือ 2 และ วิชาการงานอาชีพเพิ่มเติมได้เกรด 3.5 หรือ 4 แล้ว จัดอยู่ในกลุ่มอ่อน",
            "34" => "กฎข้อที่ 34 ถ้า วิชาภาษาอังกฤษได้เกรด 1, 1.5 หรือ 2 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 1, 1.5 หรือ 2 และ วิชาการงานอาชีพเพิ่มเติมได้เกรด 2.5 หรือ 3 และ วิชาประวัติศาสตร์ได้เกรด 1, 1.5 หรือ 2 แล้ว จัดอยู่ในกลุ่มอ่อน",
            "35" => "กฎข้อที่ 35 ถ้า วิชาภาษาอังกฤษได้เกรด 1, 1.5 หรือ 2 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 1, 1.5 หรือ 2 และ วิชาการงานอาชีพเพิ่มเติมได้เกรด 2.5 หรือ 3 และ วิชาประวัติศาสตร์ได้เกรด 2.5 หรือ 3 แล้ว จัดอยู่ในกลุ่มปานกลาง",
            "36" => "กฎข้อที่ 36 ถ้า วิชาภาษาอังกฤษได้เกรด 1, 1.5 หรือ 2 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 1, 1.5 หรือ 2 และ วิชาการงานอาชีพเพิ่มเติมได้เกรด 2.5 หรือ 3 และ วิชาประวัติศาสตร์ได้เกรด 3.5 หรือ 4 แล้ว จัดอยู่ในกลุ่มอ่อน",
            "37" => "กฎข้อที่ 37 ถ้า วิชาภาษาอังกฤษได้เกรด 1, 1.5 หรือ 2 และ วิชาวิทยาศาสตร์คำนวณได้เกรด 1, 1.5 หรือ 2 และ วิชาการงานอาชีพเพิ่มเติมได้เกรด 1, 1.5 หรือ 2 แล้ว จัดอยู่ในกลุ่มอ่อน"
        ];

        // ดึงข้อความกฎที่ตรงกับหมายเลขกฎ
        $rule_description = $messages[$rule_number] ?? "ไม่พบรายละเอียดของกฎที่เลือก";
    }

    // เมื่อมีการส่งแบบฟอร์มเพื่อบันทึกการแก้ไข
    if (isset($_POST['update'])) {
        $suggest_id = $_POST['suggest_id'];
        $suggest_text = $_POST['suggest'];

        // อัปเดตข้อมูลคำแนะนำในฐานข้อมูล
        $sql_update = "UPDATE suggest SET suggest_text = ?, updated_date = NOW() WHERE suggest_id = ?";
        $stmt_update = mysqli_prepare($conn, $sql_update);
        mysqli_stmt_bind_param($stmt_update, "si", $suggest_text, $suggest_id);

        if (mysqli_stmt_execute($stmt_update)) {
            echo "<script>
                    alert('แก้ไขคำแนะนำสำเร็จ!');
                    window.location.href = 'data_manage.php'; // เปลี่ยนเส้นทางไปยังหน้า data_manage.php
                </script>";
            exit;
        } else {
            echo "เกิดข้อผิดพลาดในการแก้ไขคำแนะนำ!";
        }
    }
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> edit </title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #f8f8f8;
        }

        .equal-buttons {
            flex: 1;
            margin: 0 5px;
        } .button-container {
            display: flex;
            justify-content: space-between;
        }

        .mt-3 {
            margin-top: 1rem !important;
        } .alert-info {
            color: #03045E;
            background-color: #CAF0F8;
        } .alert {
            position: relative;
            padding: 1rem 1rem;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            border-radius: 10px;
        } select {
            color: #ADB5BD; /* สีเริ่มต้นเมื่อไม่ได้เลือกค่า */
        } select:focus {
            color: #000000; /* เมื่อคลิกแล้วให้เป็นสีดำ */
        } option[value=""] {
            color: #ADB5BD; /* สีสำหรับ option ที่ไม่มีค่า */
        } option:not([value=""]) {
            color: #000000; /* สีของตัวเลือกที่มีค่า */
        }

        
        textarea[name="suggest"] {
            color: #000000 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mt-5"> แก้ไขคำแนะนำ </h1>
        <hr>
        
        <form action="" method="post">
            <input type="hidden" name="suggest_id" value="<?php echo htmlspecialchars($suggest['suggest_id']); ?>">

            <!-- แสดงหมายเลขกฎโดยไม่สามารถแก้ไขได้ -->
            <div class="mb-3">
                <label for="rule_number" class="form-label"> กำลังแก้ไขคำแนะนำของกฎข้อที่ </label>
                <input type="text" id="rule_number" name="rule_number" class="form-control" value="<?php echo htmlspecialchars($suggest['rule_number']); ?>" readonly>
            </div>

            <!-- แสดงรายละเอียดของกฎ -->
            <div id="ruleDescription" class="alert alert-info mt-3">
                <?php echo htmlspecialchars($rule_description); ?>
            </div>
            
            <div class="mb-3">
                <label for="suggest" class="form-label"> กรุณาพิมพ์รายละเอียดการแก้ไขคำแนะนำ </label>
                <textarea name="suggest" cols="30" rows="6" class="form-control" required><?php echo htmlspecialchars($suggest['suggest_text']); ?></textarea>
            </div>
            <br>
            
            <div class="button-container">
                <button type="submit" name="update" class="btn btn-success equal-buttons"> บันทึก </button>
                <a href="data_manage.php" class="btn btn-primary equal-buttons"> ย้อนกลับ </a>
            </div>
        </form>
    </div>
</body>
</html>